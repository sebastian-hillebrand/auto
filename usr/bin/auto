#!/usr/bin/php
<?php ob_start(); ?>

Auto is a collection of scripts to automate as much as possible tasks
by designing conventions and workflows for a better administrator,
developer and user experience.

    Usage: auto <command> [<context> [<target> [<event>]]]

At the moment you should not use these scripts if you have not been
told to do so. They are in a very early stage of development.

http://proojekte.github.io/auto/

<?php

/**
 * If nothing meaningful happens
 * $output will be the text on top of this file
 * and $return will indicate an error
 */

$output = ob_get_contents(); ob_end_clean();
$return = 1;

/**
 * Load functions 
 */

require('/usr/share/auto/functions.php');

if (is_readable('/usr/local/share/auto/functions.php'))
{
    require('/usr/local/share/auto/functions.php');
}

/**
 * Generate variables
 */

$command_type = get_command_type($argv);
$command      = get_command($argv);
$context_type = get_context_type($argv);
$context      = get_context($argv);
$target_type  = get_target_type($argv);
$target       = get_target($argv);
$event_type   = get_event_type($argv);
$event        = get_event($argv);
$path         = get_path($command, $context, $context_type);
$log          = '/var/log/auto/' . $path;

/**
 * If help is wanted
 * don't run any automation scripts
 * and return no error code.
 */

switch ($command)
{
    case 'help':
    case '--help':
    case '-help':
    case '-h':
    case '-?':
        $path = ''; // prevents execution of automation scripts
        $return = 0;
}

/**
 * Run an automation script if readable.
 * Otherwise return an error.
 */

if ($path <> '')
{
    // Check if local admin has created own automation script
    if (is_readable('/usr/local/share/auto/' . $path . '.php'))
    {
        include '/usr/local/share/auto/' . $path . '.php';
    }
    else
    {
        // Check if there is an official automation script
        if (is_readable('/usr/share/auto/' . $path . '.php'))
        {
            include '/usr/share/auto/' . $path . '.php';
        }
        else
        {
            $output = 'Error: Automation script /usr[/local]/share/auto/' . $path . '.php not found.';
        }
    }
}

/**
 * Output $output.
 */

output($output);

/**
 * Exit with $return.
 */

exit($return);
